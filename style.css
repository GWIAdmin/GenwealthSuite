/* =======================================================================
   Author: Genwealth 360
   Description: Core Styles
   ======================================================================= */

/* =============================
   1) THEME VARIABLES
   ============================= */
:root {
  /* Light */
  --bg-light: #eeeaff;
  --text-light: #4E4C5E;
  --card-light: #ffffff;

  /* Dark */
  --bg-dark: #101828;
  --text-dark: #9199A7;
  --card-dark: #253245;
  --section-dark: #101828;
  --h1-dark: #F8F8F9;
  --h2-dark: #F8F8F9;
  --h3-dark: #F8F8F9;
  --label-dark: #F8F8F9;

  /* Component backgrounds (dark) */
  --dependent-entry: #253245;
  --spouseSection: #253245;
  --business-name-entry: #253245;
  --business-entry: #253245;
  --ScheduleE-dark: #253245;

  /* Inputs (dark) */
  --input-dark: #3c385d;
  --select-dark: #3c385d;
  --input-bg-dark: #333;

  /* Notes */
  --notesEditor-dark: #101828a8;
  --notesContainer-dark: #253245;

  /* Accents */
  --accent: #FDB927;
  --accent-hover: #FFC107;
  --border-dark: #552583;

  /* Disclaimers */
  --disclaimer-red-light: #ff0000;
  --disclaimer-red-dark: #ff4f4f;
}

/* =============================
   2) BASE / TYPOGRAPHY
   ============================= */
body {
  font-family: 'Roboto', sans-serif;
  background-color: var(--bg-light);
  color: #E5E5E5;
  margin: 0;
  padding: 30px 0 0 0;
}

/* Smooth theme transitions (keep list lean) */
body, h1, h2, h3, section, label, input, select, textarea,
button, .container, .navbar, .notes-editor, .notes-container {
  transition: background-color .3s ease, color .3s ease, border-color .3s ease, box-shadow .3s ease, border-radius .3s ease;
}

h1, h2 { font-family: 'Merriweather', serif; margin-bottom: 20px; }

h1 { text-align: center; font-size: 2.5rem; color: var(--text-light); }

h2, h3 {
  color: var(--text-light);
  text-align: center;
  padding: 10px 0;
  background-color: #dcd6f6;
  border: 4px solid #552583;
  border-radius: 20px;
}
h2 { font-size: 1.8rem; }
h3 { font-size: 1.3rem; }

h2:hover, h3:hover { background-color: #bbabfc; cursor: pointer; border-radius: 40px; }

.red-disclaimer { color: var(--disclaimer-red-light); font-weight: bold; }
.black-disclaimer { color: black; transition: color .5s ease; }

.dynamic-heading, .apportionment-text { color: var(--text-light); }

/* =============================
   3) LAYOUT / NAV / CONTAINERS
   ============================= */
.navbar {
  position: fixed; top: 0; left: 0; width: 100%;
  background-color: var(--bg-light);
  z-index: 1000;
  display: flex; justify-content: flex-end;
  padding: 5px 20px;
}

.logo { padding: 0; margin-right: 535px; width: 200px; display: block; }

.dropdown { position: relative; display: inline-block; }
.dropbtn {
  background-color: #552583; color: #fff;
  padding: 15px; font-size: 16px; border: 0; cursor: pointer;
  margin-right: 40px; width: 230px; z-index: 100;
  border-radius: 20px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}
.dropdown:hover .dropbtn { background-color: var(--accent); }

.dropdown-content {
  display: none; position: absolute; right: 30px; margin-right: 10px;
  min-width: 160px; background-color: #552583; border-radius: 20px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 100;
}
.dropdown-content a {
  color: #fff; padding: 12px 16px; text-align: center; text-decoration: none;
  display: block; border-radius: 40px;
}
.dropdown-content a:hover { background-color: var(--accent); }
.dropdown:hover .dropdown-content { display: block; }

.container {
  position: relative; max-width: 1000px; margin: 40px auto; z-index: 2000;
  background-color: #fff; padding: 30px; border-radius: 25px;
  border: 4px solid #552583; box-shadow: 8px 16px 32px 8px rgba(0,0,0,0.2);
}

/* =============================
   4) CARDS / SECTIONS
   ============================= */
section {
  margin-bottom: 30px; padding: 20px;
  background-color: #EFEAF8;
  border: 4px solid #552583; border-radius: 20px;
  box-shadow: 0 2px 5px rgba(0,0,0,.4);
}
#spouseSection,
.dependent-entry,
.business-entry,
.business-name-entry,
.owner-section,
.w2-code-box,
.w2-block,
.schedule-e-entry {
  background-color: #fff;
  padding: 15px; margin-bottom: 15px;
  border-radius: 20px; border: 4px solid #552583;
}
.w2-block { margin-bottom: 20px; }

/* =============================
   5) NOTES
   ============================= */
.notes-area { position: fixed; top: 10px; left: 10px; z-index: 2000; display: flex; align-items: center; }
.notes-btn {
  background-color: #552583; color: #fff; border: none; cursor: pointer;
  padding: 15px 30px; font-size: 16px; border-radius: 20px;
  box-shadow: 0 4px 6px rgba(0,0,0,.2);
}
.notes-btn:hover { background-color: var(--accent); color: #552583; }

.notes-container {
  display: flex; flex-direction: column; position: absolute; top: 60px; left: 0;
  width: 405px; height: 405px; padding: 10px; box-sizing: border-box;
  background-color: #ffffff93; border: 2px solid #552583; border-radius: 15px;
  box-shadow: 0 6px 8px rgba(0,0,0,.2);
}
.hidden { display: none !important; }

.notes-toolbar { display: flex; gap: 8px; margin-bottom: 6px; }
.notes-toolbar button {
  background-color: #552583; color: #fff; border: none; cursor: pointer;
  padding: 6px 10px; font-size: 14px; border-radius: 4px;
}
.notes-toolbar button:hover { background-color: var(--accent); color: #552583; }

.notes-editor {
  flex: 1; overflow-y: auto; border: none; outline: none;
  font-size: 1.3rem; color: #333; font-family: 'Roboto', sans-serif;
  padding: 8px; box-sizing: border-box; border: 2px solid #552583; background-color: #fff;
}

/* =============================
   6) FORMS
   ============================= */
.form-group { margin-bottom: 15px; }

label { display: block; font-weight: bold; margin-bottom: 5px; color: var(--text-light); }

input, select {
  width: 100%; padding: 10px; font-size: 1rem;
  background-color: #FFFFFF; color: #000;
  border: 2px solid var(--text-light); border-radius: 5px; box-sizing: border-box;
}
/* Universal active-typing highlight */
input:focus, select:focus, textarea:focus {
  border-color: var(--accent) !important;
  background-color: #FFFACD !important;
  box-shadow: 0 0 5px rgba(253,185,39,0.6);
  outline: none;
}

.checkbox-container { display: flex; align-items: center; margin-top: 12px; }
.checkbox-container input[type="checkbox"] { width: 25px; height: 25px; margin-right: 10px; cursor: pointer; }
.checkbox-container label { font-size: 18px; color: var(--text-light); cursor: pointer; }
.checkbox-container input[type="checkbox"]:checked { accent-color: #4cd565; }

.calculation-details { display: block; font-size: .85rem; color: #666; margin-top: 4px; font-style: italic; line-height: 1.3; }

.input-completed { border: 2px solid #4cd565; }
.auto-copied { border: 2px solid #ffff00; }
.input-error { border: 2px solid red; }

/* STATE section helpers */
.state-field-loading { position: relative; opacity: .7; }
.state-field-loading::after {
  content: ''; position: absolute; top: 50%; right: 10px; width: 16px; height: 16px; margin-top: -8px;
  border: 2px solid #f3f3f3; border-top: 2px solid var(--accent); border-radius: 50%;
  animation: state-loading-spin 1s linear infinite;
}
@keyframes state-loading-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.state-field-success { border-color: #4CAF50 !important; background-color: rgba(76,175,80,.1); }
.state-field-error   { border-color: #f44336 !important; background-color: rgba(244,67,54,.1); }

#stateTaxableIncomeContent .currency-field[readonly] { background-color: rgba(253,185,39,.1); color: #333; font-weight: normal; }

/* =============================
   7) BUTTONS
   ============================= */
button {
  display: block; width: 100%; background-color: #552583; color: #E5E5E5;
  padding: 12px; border: none; font-size: 1.2rem; font-weight: bold; border-radius: 15px;
  cursor: pointer; transition: background-color .3s ease;
}
button:hover { background-color: var(--accent); }

.arrow-btn {
  display: inline-block; width: auto; background-color: #552583; color: #E5E5E5;
  padding: 5px 10px; font-size: 1rem; border: none; border-radius: 6px; cursor: pointer;
  margin-left: 8px; margin-top: 0;
}
.arrow-btn:hover { background-color: var(--accent); color: #552583; }

/* Make the "Remove Entity" button red */
.gw-entity-footer .gw-del {
  width: 350px;
  text-align: center;
  background-color: #ff4f4f; /* bright red */
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 20px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background-color 0.3s ease;
}

.gw-entity-footer .gw-del:hover {
  background-color: #ff0000; /* darker red on hover */
}

.add-w2-btn { background-color: #552583; color: #fff; border: none; cursor: pointer; padding: 10px 20px; font-size: 1rem; border-radius: 20px; margin-top: 15px; transition: background-color .3s ease; }
.add-w2-btn:hover { background-color: var(--accent); color: #552583; }
.plus-symbol { font-weight: bold; margin-left: 5px; }

.remove-w2-btn,
.remove-business-btn {
  background-color: #ff4f4f; color: #fff; border: none; cursor: pointer;
  padding: 8px 16px; font-size: .9rem; border-radius: 20px; margin-top: 10px;
  transition: background-color .3s ease;
}
.remove-business-btn { margin-bottom: 5px; }
.remove-w2-btn:hover, .remove-business-btn:hover { background-color: #ff0000; }

.undo-redo-buttons { display: flex; gap: 10px; margin-left: 10px; }
.undo-redo-buttons .notes-btn { margin: 0 1px; }

/* =============================
   8) UTILITIES / MISC
   ============================= */
.quote-section {
  margin-top: 40px; text-align: center; font-style: italic; color: #E5E5E5;
  font-size: 1.2rem; padding: 15px; background-color: #552583; border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,.4);
}
.quote-section p { margin: 5px 0; }

#backToTopBtn {
  display: none; position: fixed; bottom: 20px; right: 30px; width: 68px; z-index: 99;
  background-color: #552583; color: #fff; border: none; padding: 15px; border-radius: 20px; font-size: 18px; cursor: pointer;
  box-shadow: 0 8px 16px rgba(0,0,0,.2); transition: background-color .3s ease, box-shadow .3s ease;
}
#backToTopBtn:hover { background-color: var(--accent); box-shadow: 0 6px 12px rgba(0,0,0,.3); }

.state-breakdown-rows-container { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
.state-breakdown-row { display: flex; gap: 10px; }
.state-breakdown-left, .state-breakdown-right { flex: 1; }

.collapsible-content { max-height: 0; overflow: hidden; transition: max-height .4s ease-in-out; }
.collapsible-content.active { max-height: 2000px; }

#petSprite { transition: top 1.0s ease-in-out, left 1.0s ease-in-out; pointer-events: none; }
#doNotTouchBtn { background-color: #ff4f4f; color: #fff; border: none; cursor: pointer; padding: 10px 20px; font-size: 1rem; border-radius: 20px; margin-top: 15px; transition: background-color .3s ease; }

/* Tax due pill */
.ccorp-tax-due {
  border: 2px solid #4CAF50; padding: 10px; border-radius: 20px; font-weight: bold;
  background-color: #EFEEF2; color: var(--text-light);
}

/* Reasonable Compensation */
.res-comp-container { display: flex; flex-direction: column; margin-bottom: 8px; }
.res-comp-label { font-weight: bold; color: var(--text-light); margin-bottom: 4px; }
.res-comp-input {
  width: 100%; padding: 10px; border: 2px solid var(--text-light); border-radius: 5px;
  background-color: #FFFFFF; color: #000000; margin-bottom: 8px; box-sizing: border-box;
}
.res-comp-btn-container { display: flex; gap: 10px; justify-content: center; }
.res-comp-btn {
  padding: 6px 10px; font-size: 1rem; margin-top: 20px; margin-bottom: 10px;
  background-color: #552583; color: #E5E5E5; border: none; border-radius: 20px; cursor: pointer; transition: background-color .3s ease;
}
.res-comp-btn:hover { background-color: var(--accent); color: #552583; }

/* =============================
   9) DARK MODE (OVERRIDES ONLY)
   ============================= */
body.dark-mode { background-color: var(--bg-dark) !important; color: var(--text-dark) !important; }
body.dark-mode input, body.dark-mode select, body.dark-mode textarea { color: var(--h3-dark) !important; }
body.dark-mode input:-webkit-autofill { -webkit-text-fill-color: var(--h3-dark) !important; }

.dark-mode .container { background-color: var(--card-dark) !important; color: var(--text-dark) !important; box-shadow: 0 4px 8px rgba(0,0,0,.6) !important; }
.dark-mode .navbar { background-color: #101828 !important; color: #F8F8F9 !important; }

.dark-mode input { background-color: var(--input-dark) !important; color: var(--text-dark) !important; }
.dark-mode select { background-color: var(--select-dark) !important; color: var(--text-dark) !important; }

/* Opened listbox (options) */
body.dark-mode select option,
body.dark-mode select optgroup { background-color: var(--card-dark); color: var(--h3-dark); }
body.dark-mode select option:hover,
body.dark-mode select option:checked { background-color: #2f3a4a; color: var(--h1-dark); }
body.dark-mode select option[disabled],
body.dark-mode select optgroup[disabled] { color: #6f7a88; opacity: 1; }

/* Focus ring parity (gold) */
body.dark-mode input:focus,
body.dark-mode select:focus,
body.dark-mode textarea:focus {
  border-color: var(--accent) !important;
  background-color: rgba(253,185,39,.2) !important;
  box-shadow: 0 0 5px rgba(253,185,39,.5);
  outline: none;
}

/* Sections / cards */
.dark-mode section { background-color: var(--section-dark) !important; border-color: var(--border-dark) !important; }
.dark-mode .schedule-e-entry { background-color: var(--ScheduleE-dark) !important; }
.dark-mode .spouseSection { background-color: var(--spouseSection) !important; }
.dark-mode .business-name-entry { background-color: var(--business-name-entry) !important; }
.dark-mode .business-entry { background-color: var(--business-entry) !important; }
.dark-mode .dependent-entry { background-color: var(--dependent-entry) !important; }
body.dark-mode .w2-block { background-color: var(--business-entry); border-color: var(--border-dark); color: var(--h3-dark); }
body.dark-mode .w2-code-box { background-color: var(--business-entry) !important; border-color: var(--border-dark) !important; }

.dark-mode label { color: var(--label-dark) !important; }
.dark-mode h1 { color: var(--h1-dark); }
.dark-mode h2, .dark-mode h3 {
  color: var(--h2-dark);
  background-color: #552583; border: none; border-radius: 20px;
  border-bottom: 4px solid #552583; border-top: 4px solid #552583; border-right: 4px solid #552583; border-left: 4px solid #552583;
}
.dark-mode h2:hover, .dark-mode h3:hover { background-color: var(--accent-hover); border-radius: 40px; cursor: pointer; }

body.dark-mode .dynamic-heading, body.dark-mode .apportionment-text { color: var(--h3-dark); }
body.dark-mode .red-disclaimer { color: var(--disclaimer-red-dark) !important; }
body.dark-mode .black-disclaimer { color: white; }

.dark-mode .notes-editor { background-color: var(--notesEditor-dark) !important; color: var(--h3-dark) !important; border: 2px solid var(--border-dark) !important; }
.dark-mode .notes-container { background-color: var(--notesContainer-dark) !important; border: 4px solid var(--border-dark); }

body.dark-mode .ccorp-tax-due { background-color: #3c385d; color: var(--h3-dark); }

body.dark-mode .res-comp-label { color: var(--h3-dark); }
body.dark-mode .res-comp-input { background-color: var(--input-dark); color: var(--h3-dark); border: 2px solid var(--border-dark); }
body.dark-mode .res-comp-btn { background-color: #552583; color: var(--h3-dark); }
body.dark-mode .res-comp-btn:hover { background-color: var(--accent); color: #552583; }

.dark-mode-toggle { position: relative; width: 60px; height: 25px; }
.dark-mode-toggle input[type="checkbox"] { display: none; }
.dark-mode-label {
  background-color: #552583; border-radius: 25px; top: 8px; right: 30px;
  width: 130%; height: 129%; display: block; cursor: pointer; position: relative;
  transition: background-color .3s ease;
}
.toggle-ball { position: absolute; top: 2px; left: 2px; width: 28px; height: 28px; background-color: #fff; border-radius: 50%; transition: transform .5s ease, background-color .5s ease; }
.dark-mode-toggle input[type="checkbox"]:checked + .dark-mode-label { background-color: var(--accent); }
.dark-mode-toggle input[type="checkbox"]:checked + .dark-mode-label .toggle-ball { transform: translateX(45px); }

.dark-mode #stateTaxableIncomeContent .currency-field[readonly] { background-color: rgba(253,185,39,.2); color: var(--h3-dark); }

#calculateStateTaxesBTN.state-update {
  background: linear-gradient(135deg, #ff7a59, #ff9f1a);
  color: #1b1b1b;
}

/* Smooth, on-button gradient while loading */
@property --mix {
  syntax: '<percentage>';
  inherits: false;
  initial-value: 0%;
}

#calculateStateTaxesBTN.is-loading {
  --mix: 0%;
  background: linear-gradient(
    135deg,
    color-mix(in oklab, #fa4e22 calc(100% - var(--mix)), #ff9f1a var(--mix)),
    color-mix(in oklab, #ff9f1a calc(100% - var(--mix)), #fa4e22 var(--mix))
  );
  background-size: 200% 200%;
  animation: stateBtnPulse 0.9s ease-in-out infinite alternate;
  color: #1b1b1b;            /* stays readable on warm gradient */
  cursor: progress;          /* keep the loading cursor */
}

@keyframes stateBtnPulse {
  0%   { --mix: 0%;   background-position: 0% 50%; }
  100% { --mix: 100%; background-position: 100% 50%; }
}

/* Button loading animation (replaces separate state-progress bar) */
#calculateStateTaxesBTN.is-loading {
  position: relative;
  cursor: progress;
}

/* === Restructure Card UI (replaces the old grid/table styles) === */

/* neutralize your global h2 & button rules inside this component only */
.gw-restruct-header {
  background: transparent !important;
  border: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  text-align: left !important;
  color: inherit !important;
  font-weight: 800 !important;
  font-size: clamp(24px, 3vw, 34px) !important;
  cursor: default !important;
}
.gw-controls button,
#gw-add-row, #gw-reset, #gw-export {
  display: inline-flex !important;
  width: auto !important;
  align-items: center;
  justify-content: center;
  height: 36px;
  padding: 6px 12px !important;
  font-size: 14px !important;
  line-height: 1 !important;
  border-radius: 8px !important;
}

/* toolbar + rate input */
.gw-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 10px 12px;
  background: #ffffff;
  border: 2px solid var(--border-dark);
  border-radius: 12px;
}

#gw-entity-name { height: 36px; line-height: 36px; }

#gw-tax-rate {
  height: 36px;
  line-height: 36px;
  font-size: 16px;
  max-width: 110px;
}

/* card list */
.gw-card-list {
  display: grid;
  grid-template-columns: 1fr;
  gap: 14px;
}
@media (min-width: 880px) {
  .gw-card-list { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
}

.gw-entity-footer {
  margin-top: 14px;
  display: flex;
  justify-content: center;
}

/* single card */
.gw-card {
  background: #fff;
  border: 4px solid #552583;
  border-radius: 16px;
  padding: 14px;
}
body.dark-mode .gw-card {
  background: var(--business-entry);
  border-color: var(--border-dark);
}

/* card header: name + delete */
.gw-card-head {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: center;
  margin-bottom: 10px;
}
.gw-card .gw-del {
  background: #ff4f4f;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 20px;
  cursor: pointer;
}
.gw-card .gw-del:hover { background: #ff0000; }

/* card body grid (three fields + chips) */
.gw-card-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 10px;
  align-items: end;
}
@media (max-width: 640px) {
  .gw-card-grid { grid-template-columns: 1fr; }
}

/* money inputs scoped here */
.gw-money {
  width: 100% !important;
  padding: 10px !important;
  box-sizing: border-box;
  font-size: 14px;
}

.gw-chips {
  display: flex !important;
  flex-direction: row !important;
  gap: 10px !important;
  align-items: center !important;
  flex-wrap: nowrap !important;   /* keep chips on one row; allow horizontal scroll instead */
  justify-content: flex-start !important;
}

/* Smooth in/out for the Auto chip (no abrupt shift) */
.gw-chip {
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  opacity: 0;          /* hidden by default */
  max-width: 0;        /* collapse width when hidden */
  margin-left: 0;      /* no gap when hidden */
  transition:
    opacity 180ms ease,
    max-width 220ms ease,
    margin-left 180ms ease;
}

/* Visible state: expand + fade in */
.gw-chip.is-visible {
  opacity: 1;
  max-width: 360px;    /* large enough for full label */
  margin-left: 6px;    /* your chip gap when shown */
}

/* Only hide empty chips when NOT visible */
.gw-chip:not(.is-visible):empty {
  display: none;
  padding: 0;
  border: 0;
  background: none;
}

/* ====== Auto toggle (accessible checkbox styled as a switch) ====== */

.gw-switch {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
  vertical-align: middle;
}

.gw-switch-input {
  /* Keep the real checkbox focusable and interactive, but visually hidden */
  position: absolute;
  opacity: 0;
  width: 1px;
  height: 1px;
  margin: -1px;
  overflow: hidden;
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  border: 0;
  padding: 0;
}

/* The visual track */
.gw-switch-slider {
  position: relative;
  display: inline-block;
  width: 42px;
  height: 24px;
  border-radius: 999px;
  background: #d1d5db;            /* neutral track */
  transition: background-color 160ms ease, box-shadow 160ms ease;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.08);
}

/* The thumb */
.gw-switch-slider::before {
  content: "";
  position: absolute;
  top: 2px;
  left: 2px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #ffffff;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
  transition: transform 160ms ease;
}

/* Checked state */
.gw-switch-input:checked + .gw-switch-slider {
  background: #2563eb;           /* primary track when on */
}

.gw-switch-input:checked + .gw-switch-slider::before {
  transform: translateX(18px);   /* 42 - 24 = 18 */
}

/* Focus-visible ring for keyboard users */
.gw-switch-input:focus-visible + .gw-switch-slider {
  box-shadow:
    0 0 0 1px #fff,
    0 0 0 3px rgba(37,99,235,0.6);
}

/* Disabled state (if you ever disable it) */
.gw-switch-input:disabled + .gw-switch-slider {
  opacity: 0.6;
  cursor: not-allowed;
}

.gw-switch-text {
  line-height: 1;
}

/* Optional: better spacing before the chip */
#restructure .gw-chip {
  margin-left: 6px;
}

/* ===================================================================
   Chips & Pills — harmonized with root variables (light + dark parity)
   =================================================================== */

/* Base styles shared by both chip and pill variants */
.gw-chip,
.gw-pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 0.875rem;
  line-height: 1;
  background: var(--card-light);     /* light-mode surface from :root */
  border: 2px solid #552583;         /* brand border (keeps existing look) */
  transition: background-color .25s ease, color .25s ease,
              border-color .25s ease, box-shadow .2s ease;
  white-space: nowrap;
  vertical-align: middle;
}

/* Chip: neutral surface (used throughout the UI) */
.gw-chip {
  background: var(--card-light);
  color: var(--text-light);
  border-color: #552583;
  box-shadow: 0 6px 12px rgba(28, 12, 44, 0.12);
  display: inline-flex !important;   /* keep inline flow */
  flex: 0 0 auto !important;         /* don't grow or shrink to fill line */
  width: auto !important;            /* ensure no full-width override */
  max-width: none !important;
  min-width: 0 !important;
  white-space: nowrap !important;  /* keep contents on one line inside the chip */
}

/* Pill: stronger/fill variant (brand-filled style in light mode) */
.gw-pill {
  background:#FFFFFF;               /* brand-filled pill */
  color: #000000;                  
  border-color: #552583;
  display: inline-flex !important;
  flex-wrap: nowrap !important;
  width: auto !important;
  white-space: nowrap !important;
  margin: 0 !important;
  flex-direction: row !important ;
}

/* Layout helper for lists of chips/pills */
.gw-summary {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;          /* keep chips side-by-side */
  align-items: center !important;
  justify-content: center !important;
  gap: 30px !important;
  overflow-x: auto !important;          /* allow horizontal scroll on narrow screens */

  margin-bottom: 8px;
  margin-top: 16px;
}

.gw-summary > * {
  display: inline-flex !important;
  flex: 0 0 auto !important;
  width: auto !important;
  min-width: 0 !important;
}

/* Hover / focus affordances (subtle) */
.gw-chip:hover, .gw-chip:focus,
.gw-pill:hover, .gw-pill:focus {
  box-shadow: 0 8px 18px rgba(0,0,0,0.06);
  transform: translateY(-1px);
}

/* Dark-mode parity — follow your existing dark-mode variable pattern */
body.dark-mode .gw-chip {
  background: #000000;
  border-color: var(--border-dark);
  color: var(--h3-dark);
  box-shadow: none;
}

body.dark-mode .gw-pill {
  /* treat pill as a brand-accent pill in dark mode while preserving contrast */
  background: #000000;
  color: var(--h3-dark);
  border-color: var(--border-dark);
  box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}

/* Small helper text */
.gw-note {
  color: var(--text-light);
  font-size: 14px;
  margin: 10px 0 14px;
}

body.dark-mode .gw-controls{
  background: var(--card-dark) !important;
  border-color: var(--border-dark) !important;
}

/* Center the last card when there’s an odd count (desktop, 2-col grid) */
@media (min-width: 880px) {
  .gw-card-list > .gw-card:last-child:nth-child(odd) {
    grid-column: 1 / -1;              /* take the full row */
    justify-self: center;              /* center within that row */
    width: calc((100% - 14px) / 2);    /* same width as one column (gap = 14px) */
  }
}

/* ============== Smooth UX for Add/Delete in Restructure ============== */

/* Micro-interactions for buttons */
#gw-add-row,
.gw-card .gw-del {
  transition:
    background-color .20s ease,
    color .20s ease,
    transform .12s ease,
    box-shadow .20s ease,
    filter .20s ease;
}

#gw-add-row:hover { box-shadow: 0 6px 14px rgba(0,0,0,.15); }
#gw-add-row:active { transform: translateY(1px) scale(0.98); }

.gw-card .gw-del:hover { filter: brightness(1.05); box-shadow: 0 4px 8px rgba(0,0,0,.20); }
.gw-card .gw-del:active { transform: scale(0.92); }

/* Card entry/exit animations */
.gw-card {
  transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
}

/* start state for newly-mounted cards (removed next frame via JS) */
.gw-card.gw-card-enter {
  opacity: 0;
  transform: translateY(8px) scale(0.58);
}

/* animate out before removal */
.gw-card.gw-card-removing {
  animation: gwCardOut .25s ease forwards;
}

@keyframes gwCardOut {
  to {
    opacity: 0;
    transform: translateY(8px) scale(0.98);
  }
}

/* brief highlight when a new card is added and scrolled into view */
.gw-card.gw-card-pulse { animation: gwCardPulse .5s ease-out; }
@keyframes gwCardPulse {
  0%   { box-shadow: 0 0 0 rgba(85,37,131,0); }
  50%  { box-shadow: 0 0 0 6px rgba(85,37,131,.20); }
  100% { box-shadow: 0 0 0 rgba(85,37,131,0); }
}

.gw-name {
  width: 100%;
  padding: 10px;
  border: 2px solid #552583;
  border-radius: 8px;
  font-size: 14px;
}
body.dark-mode .gw-name {
  background: var(--business-entry);
  border-color: var(--border-dark);
  color: var(--h3-dark);
}

/* === 2025 Restructure: entity-scoped panels === */
.gw-entity {
  background: #fff;
  border: 4px solid #552583;
  border-radius: 16px;
  margin-bottom: 16px;
  padding: 10px; /* head/body manage inner padding */
}
/* 2025 Restructure: group subheaders inside the entity list */
.gw-entity-subheader {
  margin: 12px 0 8px;
  padding: 8px 12px;
  font-weight: 800;
  font-size: 0.95rem;
  letter-spacing: .3px;
  /* Center it */
  text-align: center;
  color: var(--text-light);
  background: #cab9ff;
  border: 4px solid #552583;
  border-radius: 12px;
}
body.dark-mode .gw-entity-subheader {
  color: var(--h3-dark);
  background: #38135f;
  border-color: var(--border-dark);
}

/* Collapse body to zero padding when closed; smaller when open */
.gw-entity-body.collapsible-content {
  max-height: 0;
  overflow: hidden;
  padding: 0 14px;                  /* was 12px 14px; zero vertical padding when closed */
  transition: max-height .25s ease, padding .20s ease;
}
.gw-entity-body.collapsible-content.active {
  max-height: 800px;                /* reduce from 2500px; just needs to exceed content */
  padding: 8px 14px;                /* slimmer open padding */
}

/* If the panel has no cards yet, hide the empty box entirely */
.gw-card-list:empty { display: none; }
.gw-entity-head {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 16px;
  padding: 12px 14px;
  border-radius: 16px;
  cursor: pointer;
  background: #EFEAF8;
  border-bottom: 4px solid #552583;
  border-top: 4px solid #552583;
  border-right: 4px solid #552583;
  border-left: 4px solid #552583;
}
.gw-entity-title { font-weight: 800; color: var(--text-light); }
.gw-entity-sub   { font-size: .9rem; color: #666; }
.gw-entity-body  { padding: 12px 14px; }
.gw-entity-body.collapsible-content { /* reuse your animation */
  max-height: 0; overflow: hidden; transition: max-height .4s ease-in-out;
}
.gw-entity-body.collapsible-content.active { max-height: 2500px; }

.gw-entity-summary {
  display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px;
}

/* Dark mode parity */
body.dark-mode .gw-entity { background: var(--business-entry); border-color: var(--border-dark); }
body.dark-mode .gw-entity-head { background: var(--section-dark); border-color: var(--border-dark); }
body.dark-mode .gw-entity-title, body.dark-mode .gw-entity-sub { color: var(--h3-dark); }

/* === Smooth show/hide for the Auto-rate chip (scoped) ===
   Note: .gw-chip later has global padding/border/max-width overrides.
   We out-specify those here so this chip animates cleanly. */

/* Hidden (off) state — occupies zero width */
.gw-controls .gw-chip.gw-chip-auto {
  opacity: 0;
  max-width: 0 !important;      /* defeat global max-width: none */
  margin-left: 0;
  padding-left: 0 !important;    /* defeat global padding */
  padding-right: 0 !important;
  border-width: 0 !important;    /* defeat global 2px border */
  overflow: hidden;
  transition:
    opacity 700ms ease,
    max-width 600ms ease,
    margin-left 700ms ease,
    padding 700ms ease,
    border-width 700ms ease;
}

/* Visible (on) state — expand & fade with real chip chrome */
.gw-controls .gw-chip.gw-chip-auto.is-visible {
  opacity: 1;
  max-width: 420px !important;   /* big enough for full label */
  margin-left: 6px;
  padding: 8px 12px !important;  /* restore chip padding */
  border-width: 2px !important;  /* restore chip border */
}

/* ==================================== */
/* === Strategic Adjustment Summary === */
/* ==================================== */
.adj-pillbar {
  display: flex;
  gap: 25px;
  flex-wrap: wrap;
  justify-content: center;
  margin: 12px 0 6px;
}

/* === Controls: pills left (stacked), buttons right (stacked) === */
.adj-controls {
  display: grid;
  grid-template-columns: 1fr auto;   /* left stack | right stack */
  gap: 12px 16px;
  align-items: center;
  background: var(--card-light);
  border: 4px solid #552583;
  border-radius: 12px;
  padding: 12px 14px;
  margin: 8px 0 14px;
}

#adj-add-row,
#adj-reset-rows {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: auto;
  padding: 10px 14px;
  white-space: nowrap;
  font-size: 16px;
}

/* Hint goes full width under both columns */
.adj-controls .adj-hint {
  grid-column: 1 / -1;
  font-size: .9rem;
  color: #666;
}

/* Table shell */
.adj-table {
  width: 98%;
  max-width: 100%;
  border: 4px solid #552583;
  border-radius: 12px;
  background: var(--card-light);
  overflow-x: hidden;           /* prevent right overflow */
}

.adj-row {
  display: grid;
  grid-template-columns:
    minmax(360px, 2fr)   /* Description: wider baseline, expands more */
    minmax(320px, 1.2fr) /* Source: solid baseline, expands some */
    minmax(140px, 0.8fr) /* Amount: compact but flexible */
    64px;                /* Delete */
  gap: 8px;
  align-items: center;
  padding: 10px;
  min-width: 0;          /* allow the grid to shrink with the container */
}

.adj-header {
  background: #efeaf8;
  font-weight: 700;
  border-bottom: 2px solid #552583;
  justify-items: center;
  font-size: 20px;
  color: var(--text-light);
}

/* Inputs */
.adj-cell input[type="text"],
.adj-cell select {
  width: 100%;
  padding: 10px;
  font-size: 15px;
  box-sizing: border-box;
  background: #ffffff;
  color: #000000;
  border: 2px solid var(--text-light);
}

.adj-cell.w-amount {
  display: flex;
  justify-content: center;
}

/* Make the Amount box a touch wider and centered */
.adj-cell .adj-money {
  width: clamp(120px, 70%, 220px);
  margin: 0 auto;
}

/* Row separators + delete */
.adj-row:not(.adj-header) { border-top: 1px solid #e1d7ff; }
.adj-row .del-btn {
  background: #ff4f4f;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
  cursor: pointer;
}
.adj-row .del-btn:hover { background: #ff0000; }

/* Totals/Narrative keep existing look */
.adj-narrative { margin-top: 14px; }
.adj-narrative-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}
.adj-narrative-actions button { width: auto; padding: 8px 12px; }

/* ---------- Dark mode parity ---------- */
body.dark-mode .adj-controls {
  background: var(--card-dark);
  border-color: var(--border-dark);
  color: var(--h3-dark);
}
body.dark-mode .adj-table {
  background: var(--business-entry);
  border-color: var(--border-dark);
}
body.dark-mode .adj-header {
  background: #38135f;
  color: var(--h3-dark);
  border-bottom: 2px solid var(--border-dark);
}
body.dark-mode .adj-row { border-top-color: #2f3a4a; }
body.dark-mode .adj-cell input[type="text"],
body.dark-mode .adj-cell select {
  background: var(--input-dark);
  color: var(--h3-dark);
  border: 2px solid var(--border-dark);
}
body.dark-mode .adj-row .del-btn { background: #ff4f4f; color: #fff; }
body.dark-mode .adj-row .del-btn:hover { background: #ff0000; }

/* ---------- Responsive ---------- */
@media (max-width: 980px) {
  .adj-row {
    grid-template-columns:
      minmax(300px, 1.6fr)
      minmax(260px, 1fr)
      minmax(120px, 0.7fr)
      56px;
  }
}

@media (max-width: 720px) {
  .adj-row { grid-template-columns: 1fr; }
  .adj-cell.w-source,
  .adj-cell.w-amount,
  .adj-cell.w-del { grid-column: 1 / -1; }
}

/* ==== Excel Preview (modal) ==== */
.preview-btn { margin-top: 10px; }

.gw-modal.hidden { display: none !important; }
.gw-modal { position: fixed; inset: 0; z-index: 5000; }
.gw-modal__overlay { position: absolute; inset: 0; background: rgba(0,0,0,.45); }
.gw-modal__dialog {
  position: relative; margin: 5vh auto; max-width: 2100px; width: calc(100% - 40px);
  background: #fff; border: 4px solid #552583; border-radius: 16px; overflow: hidden;
}
.gw-modal__header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px; background: #efeaf8; border-bottom: 4px solid #552583;
}
.gw-modal__close { width: auto; padding: 8px 12px; }
.gw-modal__body { padding: 10px; }
.gw-modal__empty { padding: 12px; font-weight: 700; color: #552583; }

/* Grid wrapper: scrollable */
.gw-gridwrap { max-height: 70vh; overflow: auto; border: 2px solid #552583; border-radius: 12px; }

/* Excel-like table */
.gw-grid { width: 100%; border-collapse: separate; border-spacing: 0; }
.gw-grid th, .gw-grid td {
  border: 1px solid #d9d2f3; padding: 8px 10px; background: #fff; color: #000; font-size: 0.95rem;
}
.gw-grid thead th {
  position: sticky; top: 0; z-index: 2; background: #cab9ff; border-bottom: 2px solid #552583; text-align: left;
}
.gw-grid .col-label {
  position: sticky; left: 0; z-index: 1; background: #f5f0ff; font-weight: 700; min-width: 260px;
  border-right: 2px solid #552583;
}

/* Zebra rows */
.gw-grid tbody tr:nth-child(even) td { background: #faf7ff; }

/* Section bands & spacers */
.gw-grid .section-row td {
  background: #efeaf8; color: #4E4C5E; font-weight: 800; border-top: 2px solid #552583; border-bottom: 2px solid #552583;
}
.gw-grid .spacer td { height: 8px; padding: 0; background: transparent; border: 0; }

/* Dark-mode parity */
body.dark-mode .gw-modal__dialog { background: var(--card-dark); border-color: var(--border-dark); }
body.dark-mode .gw-modal__header { background: var(--section-dark); border-color: var(--border-dark); }
body.dark-mode .gw-gridwrap { border-color: var(--border-dark); }
body.dark-mode .gw-grid th, body.dark-mode .gw-grid td { background: var(--business-entry); color: var(--h3-dark); border-color: var(--border-dark); }
body.dark-mode .gw-grid thead th { background: #38135f; color: var(--h3-dark); border-bottom-color: var(--border-dark); }
body.dark-mode .gw-grid .col-label { background: #2f2247; border-right-color: var(--border-dark); }
body.dark-mode .gw-grid tbody tr:nth-child(even) td { background: #2b2440; }
body.dark-mode .gw-grid .section-row td { background: #2f2247; color: var(--h3-dark); border-color: var(--border-dark); }

/* =======================================================
   AI Strategy — single source of truth (brand-aligned)
   ======================================================= */

/* Section chrome */
#ai-strategy {
  background: #EFEAF8;
  border: 4px solid #552583;
  border-radius: 16px;
  color: var(--text-light);
}
body.dark-mode #ai-strategy {
  background: var(--business-entry);
  border-color: var(--border-dark);
  color: var(--h3-dark);
}

/* Summary pills (already on-brand; just small spacing) */
#ai-strategy .gw-summary { display: flex; flex-wrap: wrap; gap: 14px; margin: 6px 0 10px; }
#ai-strategy .gw-pill { padding: 6px 10px; border-radius: 999px; font-weight: 700; }

/* Action row */
#ai-strategy .gw-controls {
  display: flex; gap: 10px; align-items: center; justify-content: flex-start;
  background: #fff; border: 2px solid #552583; border-radius: 12px; padding: 8px 10px;
}
body.dark-mode #ai-strategy .gw-controls { background: var(--card-dark); border-color: var(--border-dark); }

/* Output box */
#ai-output {
  border: 2px solid #552583; border-radius: 12px; min-height: 180px;
  background: #fff; color: var(--text-light);
  font-size: .92rem; line-height: 1.35;
}
body.dark-mode #ai-output { background: #0e0e16; color: #f1f1f1; border-color: var(--border-dark); }

/* List layout */
#ai-suggestions.gw-card-list {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}
@media (min-width: 880px) {
  #ai-suggestions.gw-card-list { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
}

/* Card shell */
#ai-suggestions .gw-card.ai-card {
  background: #fff;
  border: 3px solid #552583;
  border-radius: 16px;
  color: var(--text-light);
  box-shadow: 0 3px 10px rgba(0,0,0,.08);
  padding: 16px;
}
#ai-suggestions .gw-card.ai-card:hover { box-shadow: 0 6px 16px rgba(0,0,0,.12); }

body.dark-mode #ai-suggestions .gw-card.ai-card {
  background: var(--business-entry);
  border-color: var(--border-dark);
  color: var(--h3-dark);
  box-shadow: 0 8px 18px rgba(0,0,0,.30);
}

/* Header */
#ai-suggestions .gw-card.ai-card .gw-card-head {
  display: grid; grid-template-columns: 1fr auto; align-items: center; column-gap: 10px;
  margin-bottom: 10px;
}
#ai-suggestions .ai-title {
  font-family: 'Merriweather', serif;
  font-size: 1.05rem; line-height: 1.25; letter-spacing: .2px;
  color: inherit;
}
#ai-suggestions .ai-chip {
  display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
  border: 1px solid #552583; border-radius: 999px; background: #EFEAF8;
  color: #552583; font-size: .78rem; font-weight: 700;
}
body.dark-mode #ai-suggestions .ai-chip { background: #1b1630; border-color: var(--border-dark); color: #eae7ff; }

/* Body grid: Why | Impact | Meta (rail) */
#ai-suggestions .gw-card.ai-card .gw-card-grid {
  display: grid; grid-template-columns: 1.1fr 0.9fr 0.6fr; gap: 12px; align-items: start;
}
@media (max-width: 880px) {
  #ai-suggestions .gw-card.ai-card .gw-card-grid { grid-template-columns: 1fr; }
}

/* Labels + panels */
#ai-suggestions .gw-card.ai-card label {
  font-size: .82rem; color: currentColor; opacity: .85; display: block; margin-bottom: 6px;
}
#ai-suggestions .gw-card.ai-card .gw-card-grid > div > div {
  background: #fff; border: 2px solid #d9d2f3; border-radius: 12px;
  padding: 10px; min-height: 72px; line-height: 1.35; white-space: pre-wrap; word-break: break-word;
}
body.dark-mode #ai-suggestions .gw-card.ai-card .gw-card-grid > div > div {
  background: #0e0e16; border-color: #2b2148; color: #eae7ff;
}

/* Neatly stacked AI card layout */
#ai-suggestions .gw-card.ai-card .gw-card-stack {
  display: flex;
  flex-direction: column;
  gap: 14px;
  align-items: stretch;
}

/* Each panel (Why, Impact, Meta) fills width, stacked top to bottom */
#ai-suggestions .gw-card.ai-card .gw-card-stack > div > label {
  font-weight: 700;
  margin-bottom: 6px;
  display: block;
}

#ai-suggestions .gw-card.ai-card .gw-card-stack > div > div {
  background: #fff;
  border: 2px solid #d9d2f3;
  border-radius: 12px;
  padding: 10px;
  line-height: 1.35;
  white-space: pre-wrap;
  word-break: break-word;
}

body.dark-mode #ai-suggestions .gw-card.ai-card .gw-card-stack > div > div {
  background: #0e0e16;
  border-color: #2b2148;
  color: #eae7ff;
}

/* Meta rail */
#ai-suggestions .ai-rail > div { display: grid; gap: 6px; }
#ai-suggestions .ai-conf {
  display: inline-block; padding: 4px 8px; border-radius: 999px;
  font-size: .75rem; font-weight: 700; background: #E8FFF3; color: #076b36; border: 1px solid #9ee2bf;
}
body.dark-mode #ai-suggestions .ai-conf { background: #0f2319; color: #a3f5c8; border-color: #0a3b23; }

#ai-suggestions .ai-tags { display: flex; flex-wrap: wrap; gap: 6px; }
#ai-suggestions .ai-tag {
  padding: 2px 8px; border: 1px solid #a58be6; background: #F5F0FF;
  border-radius: 999px; font-size: .75rem; font-weight: 700; color: #552583;
}
body.dark-mode #ai-suggestions .ai-tag { background: #1b1630; border-color: #6441b8; color: #eae7ff; }

/* References */
#ai-suggestions .ai-refs { margin-top: 10px; }
#ai-suggestions .ai-refs ul { margin: 6px 0 0 18px; }
#ai-suggestions .ai-refs li { margin: 2px 0; }

/* Hide empty Impact column if AI doesn’t send it */
#ai-suggestions .gw-card.ai-card .gw-card-grid > div[hidden] { display: none; }

/* ================================
   New York Section Styling
   ================================ */
.ny-section-wrapper {
  background: #ffffff;
  border: 4px solid #552583;
  border-radius: 20px;
  padding: 18px 20px;
  margin-top: 25px;
  box-shadow: 0 2px 5px rgba(0,0,0,.25);
}

.ny-subheader {
  margin: 0 0 15px 0;
  padding: 10px;
  text-align: center;
  font-size: 1.3rem;
  background: #dcd6f6;
  color: #4E4C5E;
  border: 3px solid #552583;
  border-radius: 15px;
}

body.dark-mode .ny-section-wrapper {
  background: var(--business-entry);
  border-color: var(--border-dark);
}

body.dark-mode .ny-subheader {
  background: #38135f;
  color: var(--h3-dark);
  border-color: var(--border-dark);
}

/* Layout row for Yonkers + NYC when both are present */
.ny-locals-row {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 20px;
}

/* Let each local panel share the row, but stack on narrow screens */
.ny-locals-row .ny-section-wrapper {
  flex: 1 1 0;
  min-width: 260px;
}

/* Section-specific header colors */
.ny-subheader-state {
  /* keep existing purple theme */
}

.ny-subheader-yonkers {
  background: #ffe7d9;       /* soft orange */
  border-color: #d9480f;
}

.ny-subheader-nyc {
  background: #dbeafe;       /* soft blue */
  border-color: #1d4ed8;
}

/* Tag pill inside each header */
.ny-tag {
  display: inline-flex;
  align-items: center;
  margin-left: 8px;
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 700;
  background: #fff;
  color: #333;
}

.ny-tag-state {
  background: #fff7cc;
  color: #92400e;
}

.ny-tag-yonkers {
  background: #ffedd5;
  color: #9a3412;
}

.ny-tag-nyc {
  background: #e0ecff;
  color: #1e3a8a;
}

/* Dark mode variants */
body.dark-mode .ny-subheader-yonkers {
  background: #5b2610;
  border-color: #f97316;
}

body.dark-mode .ny-subheader-nyc {
  background: #1f2937;
  border-color: #60a5fa;
}

body.dark-mode .ny-tag {
  background: #111827;
  color: #f9fafb;
}

body.dark-mode .ny-tag-state {
  background: #4b5563;
  color: #fbbf24;
}

body.dark-mode .ny-tag-yonkers {
  background: #4b2714;
  color: #fed7aa;
}

body.dark-mode .ny-tag-nyc {
  background: #111827;
  color: #bfdbfe;
}
